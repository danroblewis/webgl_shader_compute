<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Suite Manager</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            color: #cccccc;
            margin: 0;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #9cdcfe;
            margin: 0;
        }
        
        .subtitle {
            color: #858585;
            margin-top: 5px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }
        
        .sidebar {
            background: #252526;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #3e3e42;
        }
        
        .main-area {
            background: #252526;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #3e3e42;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 10px 20px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #1177bb;
        }
        
        button.secondary {
            background: #3e3e42;
        }
        
        button.secondary:hover {
            background: #4e4e52;
        }
        
        button.danger {
            background: #c72e2e;
        }
        
        button.danger:hover {
            background: #d74343;
        }
        
        .test-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .test-item {
            padding: 10px;
            margin-bottom: 5px;
            background: #2d2d30;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .test-item:hover {
            background: #3e3e42;
        }
        
        .test-item.active {
            border-color: #0e639c;
            background: #1e3a52;
        }
        
        .test-name {
            font-weight: bold;
            color: #9cdcfe;
        }
        
        .test-info {
            font-size: 12px;
            color: #858585;
            margin-top: 4px;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .editor-title {
            font-size: 18px;
            color: #9cdcfe;
        }
        
        input[type="text"],
        input[type="number"] {
            padding: 8px;
            background: #3c3c3c;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            color: #cccccc;
            font-size: 14px;
        }
        
        .grid-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .grid-controls label {
            color: #858585;
        }
        
        .frame-editor {
            margin-bottom: 30px;
        }
        
        .frame-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .frame-number {
            font-weight: bold;
            color: #dcdcaa;
        }
        
        .grid-canvas {
            display: inline-grid;
            gap: 1px;
            background: #1e1e1e;
            padding: 2px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .grid-cell {
            width: 30px;
            height: 30px;
            border: 1px solid #3e3e42;
            cursor: pointer;
            border-radius: 2px;
        }
        
        .grid-cell.empty {
            background: #1e1e1e;
        }
        
        .grid-cell.sand {
            background: #f4d03f;
        }
        
        .grid-cell.stone {
            background: #808080;
        }
        
        .cell-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .cell-type-btn {
            width: 50px;
            height: 50px;
            border: 3px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            position: relative;
        }
        
        .cell-type-btn.empty {
            background: #1e1e1e;
            color: #cccccc;
        }
        
        .cell-type-btn.sand {
            background: #f4d03f;
            color: #333;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }
        
        .cell-type-btn.stone {
            background: #808080;
        }
        
        .cell-type-btn.active {
            border-color: #0e639c;
            box-shadow: 0 0 10px rgba(14, 99, 156, 0.5);
        }
        
        .cell-type-btn .hotkey {
            position: absolute;
            bottom: 2px;
            right: 4px;
            font-size: 10px;
            opacity: 0.7;
        }
        
        .frames-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .export-section {
            margin-top: 30px;
            padding: 20px;
            background: #2d2d30;
            border-radius: 8px;
        }
        
        .export-textarea {
            width: 100%;
            min-height: 300px;
            background: #1e1e1e;
            color: #cccccc;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
        }
        
        .status-message {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
            display: none;
        }
        
        .status-message.success {
            background: #1e3a1e;
            color: #4ec9b0;
            border: 1px solid #4ec9b0;
        }
        
        .status-message.error {
            background: #3a1e1e;
            color: #f48771;
            border: 1px solid #f48771;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #858585;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß™ Test Suite Manager</h1>
        <div class="subtitle">Create and edit cellular automata test cases</div>
    </div>
    
    <div class="status-message" id="statusMessage"></div>
    
    <div class="container">
        <div class="sidebar">
            <h2 style="margin-top: 0;">Tests</h2>
            <div class="button-group" style="flex-direction: column;">
                <button onclick="loadTestSuite()">üìÇ Load test_suite.txt</button>
                <button onclick="createNewTest()" class="secondary">‚ûï New Test</button>
            </div>
            <ul class="test-list" id="testList"></ul>
        </div>
        
        <div class="main-area">
            <div id="emptyState" class="empty-state">
                <p>No test selected</p>
                <p>Load a test suite or create a new test to begin</p>
            </div>
            
            <div id="editorArea" style="display: none;">
                <div class="editor-header">
                    <div>
                        <label style="margin-right: 10px;">Test Name:</label>
                        <input type="text" id="testName" placeholder="test_name" style="width: 300px;">
                    </div>
                    <button onclick="deleteCurrentTest()" class="danger">üóëÔ∏è Delete Test</button>
                </div>
                
                <div class="grid-controls">
                    <label>Grid Size:</label>
                    <input type="number" id="gridWidth" min="2" max="20" value="5" style="width: 60px;">
                    <span>√ó</span>
                    <input type="number" id="gridHeight" min="2" max="20" value="5" style="width: 60px;">
                    <button onclick="resizeGrid()" class="secondary">Resize</button>
                </div>
                
                <div class="cell-type-selector">
                    <span style="margin-right: 10px;">Paint:</span>
                    <div class="cell-type-btn empty active" onclick="selectCellType('empty')" title="Empty (1)">
                        .
                        <span class="hotkey">1</span>
                    </div>
                    <div class="cell-type-btn sand" onclick="selectCellType('sand')" title="Sand (2)">
                        s
                        <span class="hotkey">2</span>
                    </div>
                    <div class="cell-type-btn stone" onclick="selectCellType('stone')" title="Stone (3)">
                        #
                        <span class="hotkey">3</span>
                    </div>
                </div>
                
                <h3>Frames</h3>
                <div class="frames-container" id="framesContainer"></div>
                
                <div class="button-group">
                    <button onclick="addFrame()">‚ûï Add Frame</button>
                    <button onclick="duplicateLastFrame()" class="secondary">üìã Duplicate Last Frame</button>
                </div>
                
                <div class="export-section">
                    <h3>Export Test Suite</h3>
                    <p style="color: #858585;">Copy this text and paste it into test_suite.txt</p>
                    <textarea class="export-textarea" id="exportText" readonly></textarea>
                    <div class="button-group">
                        <button onclick="copyExport()">üìã Copy to Clipboard</button>
                        <button onclick="updateExport()" class="secondary">üîÑ Refresh Export</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let tests = [];
        let currentTestIndex = -1;
        let currentCellType = 'empty';
        let isDrawing = false;
        
        const CELL_TYPES = {
            empty: '.',
            sand: 's',
            stone: '#'
        };
        
        const CELL_CLASSES = {
            '.': 'empty',
            's': 'sand',
            '#': 'stone'
        };
        
        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.style.display = 'block';
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 3000);
        }
        
        async function loadTestSuite() {
            try {
                const response = await fetch('test_suite.txt');
                if (!response.ok) {
                    throw new Error('test_suite.txt not found');
                }
                const text = await response.text();
                parseTestSuite(text);
                showStatus('Test suite loaded successfully!');
            } catch (error) {
                showStatus(`Error loading test_suite.txt: ${error.message}. Creating new suite.`, 'error');
                tests = [];
                renderTestList();
            }
        }
        
        function parseTestSuite(text) {
            tests = [];
            const lines = text.split('\n');
            let currentTest = null;
            let currentFrame = [];
            let inFrame = false;
            
            for (let line of lines) {
                line = line.trim();
                
                if (line.startsWith('TEST:')) {
                    if (currentTest && currentFrame.length > 0) {
                        currentTest.frames.push(currentFrame);
                    }
                    if (currentTest) {
                        tests.push(currentTest);
                    }
                    const name = line.substring(5).trim();
                    currentTest = { name, width: 0, height: 0, frames: [] };
                    currentFrame = [];
                    inFrame = false;
                } else if (line.startsWith('GRID:')) {
                    const dimensions = line.substring(5).trim().split('x');
                    currentTest.width = parseInt(dimensions[0]);
                    currentTest.height = parseInt(dimensions[1]);
                } else if (line === 'FRAME:') {
                    if (currentFrame.length > 0) {
                        currentTest.frames.push(currentFrame);
                    }
                    currentFrame = [];
                    inFrame = true;
                } else if (line === '') {
                    if (inFrame && currentFrame.length > 0) {
                        currentTest.frames.push(currentFrame);
                        currentFrame = [];
                        inFrame = false;
                    }
                } else if (inFrame) {
                    const row = line.split(/\s+/).filter(c => c.length > 0);
                    if (row.length > 0) {
                        currentFrame.push(row);
                    }
                }
            }
            
            if (currentFrame.length > 0 && currentTest) {
                currentTest.frames.push(currentFrame);
            }
            if (currentTest) {
                tests.push(currentTest);
            }
            
            renderTestList();
        }
        
        function createNewTest() {
            const newTest = {
                name: `new_test_${tests.length + 1}`,
                width: 5,
                height: 5,
                frames: [
                    createEmptyFrame(5, 5)
                ]
            };
            tests.push(newTest);
            renderTestList();
            selectTest(tests.length - 1);
            showStatus('New test created!');
        }
        
        function createEmptyFrame(width, height) {
            const frame = [];
            for (let y = 0; y < height; y++) {
                const row = [];
                for (let x = 0; x < width; x++) {
                    row.push('.');
                }
                frame.push(row);
            }
            return frame;
        }
        
        function renderTestList() {
            const listEl = document.getElementById('testList');
            listEl.innerHTML = '';
            
            if (tests.length === 0) {
                listEl.innerHTML = '<li style="color: #858585; padding: 10px;">No tests yet</li>';
                return;
            }
            
            tests.forEach((test, index) => {
                const li = document.createElement('li');
                li.className = 'test-item';
                if (index === currentTestIndex) {
                    li.classList.add('active');
                }
                li.onclick = () => selectTest(index);
                
                li.innerHTML = `
                    <div class="test-name">${test.name}</div>
                    <div class="test-info">${test.width}√ó${test.height} ¬∑ ${test.frames.length} frames</div>
                `;
                listEl.appendChild(li);
            });
        }
        
        function selectTest(index) {
            currentTestIndex = index;
            renderTestList();
            renderEditor();
            updateExport();
        }
        
        function renderEditor() {
            if (currentTestIndex < 0 || currentTestIndex >= tests.length) {
                document.getElementById('emptyState').style.display = 'block';
                document.getElementById('editorArea').style.display = 'none';
                return;
            }
            
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('editorArea').style.display = 'block';
            
            const test = tests[currentTestIndex];
            document.getElementById('testName').value = test.name;
            document.getElementById('gridWidth').value = test.width;
            document.getElementById('gridHeight').value = test.height;
            
            renderFrames();
        }
        
        function renderFrames() {
            const test = tests[currentTestIndex];
            const container = document.getElementById('framesContainer');
            container.innerHTML = '';
            
            test.frames.forEach((frame, frameIndex) => {
                const frameDiv = document.createElement('div');
                frameDiv.className = 'frame-editor';
                
                const header = document.createElement('div');
                header.className = 'frame-header';
                header.innerHTML = `
                    <span class="frame-number">Frame ${frameIndex + 1}</span>
                    <button onclick="deleteFrame(${frameIndex})" class="danger">Delete</button>
                `;
                frameDiv.appendChild(header);
                
                const grid = renderGrid(frame, frameIndex);
                frameDiv.appendChild(grid);
                
                container.appendChild(frameDiv);
            });
        }
        
        function renderGrid(frame, frameIndex) {
            const grid = document.createElement('div');
            grid.className = 'grid-canvas';
            grid.style.gridTemplateColumns = `repeat(${frame[0].length}, 30px)`;
            
            frame.forEach((row, y) => {
                row.forEach((cell, x) => {
                    const cellDiv = document.createElement('div');
                    cellDiv.className = `grid-cell ${CELL_CLASSES[cell]}`;
                    cellDiv.dataset.frame = frameIndex;
                    cellDiv.dataset.x = x;
                    cellDiv.dataset.y = y;
                    
                    cellDiv.addEventListener('mousedown', handleCellMouseDown);
                    cellDiv.addEventListener('mouseenter', handleCellMouseEnter);
                    
                    grid.appendChild(cellDiv);
                });
            });
            
            return grid;
        }
        
        function handleCellMouseDown(e) {
            isDrawing = true;
            paintCell(e.target);
        }
        
        function handleCellMouseEnter(e) {
            if (isDrawing) {
                paintCell(e.target);
            }
        }
        
        document.addEventListener('mouseup', () => {
            isDrawing = false;
        });
        
        function paintCell(cellDiv) {
            const frameIndex = parseInt(cellDiv.dataset.frame);
            const x = parseInt(cellDiv.dataset.x);
            const y = parseInt(cellDiv.dataset.y);
            
            const test = tests[currentTestIndex];
            test.frames[frameIndex][y][x] = CELL_TYPES[currentCellType];
            
            cellDiv.className = `grid-cell ${currentCellType}`;
            updateExport();
        }
        
        function selectCellType(type) {
            currentCellType = type;
            document.querySelectorAll('.cell-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.cell-type-btn.${type}`).classList.add('active');
        }
        
        function resizeGrid() {
            const test = tests[currentTestIndex];
            const newWidth = parseInt(document.getElementById('gridWidth').value);
            const newHeight = parseInt(document.getElementById('gridHeight').value);
            
            if (newWidth < 2 || newWidth > 20 || newHeight < 2 || newHeight > 20) {
                showStatus('Grid size must be between 2 and 20', 'error');
                return;
            }
            
            test.width = newWidth;
            test.height = newHeight;
            
            // Resize all frames
            test.frames = test.frames.map(frame => {
                const newFrame = createEmptyFrame(newWidth, newHeight);
                
                // Copy existing cells
                for (let y = 0; y < Math.min(frame.length, newHeight); y++) {
                    for (let x = 0; x < Math.min(frame[0].length, newWidth); x++) {
                        newFrame[y][x] = frame[y][x];
                    }
                }
                
                return newFrame;
            });
            
            renderTestList();
            renderFrames();
            updateExport();
            showStatus('Grid resized!');
        }
        
        function addFrame() {
            const test = tests[currentTestIndex];
            const newFrame = createEmptyFrame(test.width, test.height);
            test.frames.push(newFrame);
            renderTestList();
            renderFrames();
            updateExport();
            showStatus('Frame added!');
        }
        
        function duplicateLastFrame() {
            const test = tests[currentTestIndex];
            if (test.frames.length === 0) return;
            
            const lastFrame = test.frames[test.frames.length - 1];
            const newFrame = lastFrame.map(row => [...row]);
            test.frames.push(newFrame);
            renderTestList();
            renderFrames();
            updateExport();
            showStatus('Frame duplicated!');
        }
        
        function deleteFrame(frameIndex) {
            const test = tests[currentTestIndex];
            if (test.frames.length <= 1) {
                showStatus('Cannot delete the last frame', 'error');
                return;
            }
            test.frames.splice(frameIndex, 1);
            renderTestList();
            renderFrames();
            updateExport();
            showStatus('Frame deleted!');
        }
        
        function deleteCurrentTest() {
            if (currentTestIndex < 0) return;
            
            if (confirm('Are you sure you want to delete this test?')) {
                tests.splice(currentTestIndex, 1);
                currentTestIndex = -1;
                renderTestList();
                renderEditor();
                updateExport();
                showStatus('Test deleted!');
            }
        }
        
        // Update test name on input
        document.getElementById('testName').addEventListener('input', (e) => {
            if (currentTestIndex >= 0) {
                tests[currentTestIndex].name = e.target.value;
                renderTestList();
                updateExport();
            }
        });
        
        function updateExport() {
            const exportText = generateExportText();
            document.getElementById('exportText').value = exportText;
        }
        
        function generateExportText() {
            if (tests.length === 0) {
                return '# No tests to export\n# Create a test to begin';
            }
            
            let output = [];
            
            tests.forEach(test => {
                output.push(`TEST: ${test.name}`);
                output.push(`GRID: ${test.width}x${test.height}`);
                output.push('');
                
                test.frames.forEach(frame => {
                    output.push('FRAME:');
                    frame.forEach(row => {
                        output.push(row.join(' '));
                    });
                    output.push('');
                });
            });
            
            return output.join('\n');
        }
        
        function copyExport() {
            const text = document.getElementById('exportText').value;
            navigator.clipboard.writeText(text).then(() => {
                showStatus('Copied to clipboard!');
            }).catch(err => {
                showStatus('Failed to copy to clipboard', 'error');
            });
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Only handle number keys when not typing in an input
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }
            
            const cellTypes = ['empty', 'sand', 'stone'];
            const key = e.key;
            
            if (key >= '1' && key <= '3') {
                const index = parseInt(key) - 1;
                selectCellType(cellTypes[index]);
                e.preventDefault();
            }
        });
        
        // Auto-load on page load
        window.addEventListener('load', () => {
            loadTestSuite();
        });
    </script>
</body>
</html>
